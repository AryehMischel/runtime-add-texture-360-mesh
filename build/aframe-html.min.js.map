{"version":3,"file":"aframe-html.min.js","sources":["../src/HTMLMesh.js","../src/aframe-html.js"],"sourcesContent":["// This is a copy of https://github.com/mrdoob/three.js/blob/e523eb3bce1c10b129f53eae7835791f34a2a17c/examples/jsm/interactive/HTMLMesh.js\r\n// with a window.dispatchEvent line commented, see the TODO below.\r\n// Look at https://github.com/mrdoob/three.js/commits/dev/examples/jsm/interactive/HTMLMesh.js\r\n// to see if there are other changes that can be retrieved here.\r\nimport {\r\n\tCanvasTexture,\r\n\tLinearFilter,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tPlaneGeometry,\r\n\tsRGBEncoding,\r\n\tColor\r\n} from 'three';\r\n\r\nclass HTMLMesh extends Mesh {\r\n\r\n\tconstructor( dom ) {\r\n\r\n\t\tconst texture = new HTMLTexture( dom );\r\n\r\n\t\tconst geometry = new PlaneGeometry( texture.image.width * 0.001, texture.image.height * 0.001 );\r\n\t\tconst material = new MeshBasicMaterial( { map: texture, toneMapped: false, transparent: true } );\r\n\r\n\t\tsuper( geometry, material );\r\n\r\n\t\tfunction onEvent( event ) {\r\n\r\n\t\t\tmaterial.map.dispatchDOMEvent( event );\r\n\r\n\t\t}\r\n\r\n\t\tthis.addEventListener( 'mousedown', onEvent );\r\n\t\tthis.addEventListener( 'mousemove', onEvent );\r\n\t\tthis.addEventListener( 'mouseup', onEvent );\r\n\t\tthis.addEventListener( 'click', onEvent );\r\n\r\n\t\tthis.dispose = function () {\r\n\r\n\t\t\tgeometry.dispose();\r\n\t\t\tmaterial.dispose();\r\n\r\n\t\t\tmaterial.map.dispose();\r\n\r\n\t\t\tcanvases.delete( dom );\r\n\r\n\t\t\tthis.removeEventListener( 'mousedown', onEvent );\r\n\t\t\tthis.removeEventListener( 'mousemove', onEvent );\r\n\t\t\tthis.removeEventListener( 'mouseup', onEvent );\r\n\t\t\tthis.removeEventListener( 'click', onEvent );\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n}\r\n\r\nclass HTMLTexture extends CanvasTexture {\r\n\r\n\tconstructor( dom ) {\r\n\r\n\t\tsuper( html2canvas( dom ) );\r\n\r\n\t\tthis.dom = dom;\r\n\r\n\t\tthis.anisotropy = 16;\r\n\t\tthis.encoding = sRGBEncoding;\r\n\t\tthis.minFilter = LinearFilter;\r\n\t\tthis.magFilter = LinearFilter;\r\n\r\n\t\t// Create an observer on the DOM, and run html2canvas update in the next loop\r\n\t\tconst observer = new MutationObserver( () => {\r\n\r\n\t\t\tif ( ! this.scheduleUpdate ) {\r\n\r\n\t\t\t\t// ideally should use xr.requestAnimationFrame, here setTimeout to avoid passing the renderer\r\n\t\t\t\tthis.scheduleUpdate = setTimeout( () => this.update(), 16 );\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tconst config = { attributes: true, childList: true, subtree: true, characterData: true };\r\n\t\tobserver.observe( dom, config );\r\n\r\n\t\tthis.observer = observer;\r\n\r\n\t}\r\n\r\n\tdispatchDOMEvent( event ) {\r\n\r\n\t\tif ( event.data ) {\r\n\r\n\t\t\thtmlevent( this.dom, event.type, event.data.x, event.data.y );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\r\n\t\tthis.image = html2canvas( this.dom );\r\n\t\tthis.needsUpdate = true;\r\n\r\n\t\tthis.scheduleUpdate = null;\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tif ( this.observer ) {\r\n\r\n\t\t\tthis.observer.disconnect();\r\n\r\n\t\t}\r\n\r\n\t\tthis.scheduleUpdate = clearTimeout( this.scheduleUpdate );\r\n\r\n\t\tsuper.dispose();\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n//\r\n\r\nconst canvases = new WeakMap();\r\n\r\nfunction html2canvas( element ) {\r\n\r\n\tconst range = document.createRange();\r\n\tconst color = new Color();\r\n\r\n\tfunction Clipper( context ) {\r\n\r\n\t\tconst clips = [];\r\n\t\tlet isClipping = false;\r\n\r\n\t\tfunction doClip() {\r\n\r\n\t\t\tif ( isClipping ) {\r\n\r\n\t\t\t\tisClipping = false;\r\n\t\t\t\tcontext.restore();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( clips.length === 0 ) return;\r\n\r\n\t\t\tlet minX = - Infinity, minY = - Infinity;\r\n\t\t\tlet maxX = Infinity, maxY = Infinity;\r\n\r\n\t\t\tfor ( let i = 0; i < clips.length; i ++ ) {\r\n\r\n\t\t\t\tconst clip = clips[ i ];\r\n\r\n\t\t\t\tminX = Math.max( minX, clip.x );\r\n\t\t\t\tminY = Math.max( minY, clip.y );\r\n\t\t\t\tmaxX = Math.min( maxX, clip.x + clip.width );\r\n\t\t\t\tmaxY = Math.min( maxY, clip.y + clip.height );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcontext.save();\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.rect( minX, minY, maxX - minX, maxY - minY );\r\n\t\t\tcontext.clip();\r\n\r\n\t\t\tisClipping = true;\r\n\r\n\t\t}\r\n\r\n\t\treturn {\r\n\r\n\t\t\tadd: function ( clip ) {\r\n\r\n\t\t\t\tclips.push( clip );\r\n\t\t\t\tdoClip();\r\n\r\n\t\t\t},\r\n\r\n\t\t\tremove: function () {\r\n\r\n\t\t\t\tclips.pop();\r\n\t\t\t\tdoClip();\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}\r\n\r\n\tfunction drawText( style, x, y, string ) {\r\n\r\n\t\tif ( string !== '' ) {\r\n\r\n\t\t\tif ( style.textTransform === 'uppercase' ) {\r\n\r\n\t\t\t\tstring = string.toUpperCase();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tcontext.font = style.fontWeight + ' ' + style.fontSize + ' ' + style.fontFamily;\r\n\t\t\tcontext.textBaseline = 'top';\r\n\t\t\tcontext.fillStyle = style.color;\r\n\t\t\tcontext.fillText( string, x, y + parseFloat( style.fontSize ) * 0.1 );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction buildRectPath( x, y, w, h, r ) {\r\n\r\n\t\tif ( w < 2 * r ) r = w / 2;\r\n\t\tif ( h < 2 * r ) r = h / 2;\r\n\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo( x + r, y );\r\n\t\tcontext.arcTo( x + w, y, x + w, y + h, r );\r\n\t\tcontext.arcTo( x + w, y + h, x, y + h, r );\r\n\t\tcontext.arcTo( x, y + h, x, y, r );\r\n\t\tcontext.arcTo( x, y, x + w, y, r );\r\n\t\tcontext.closePath();\r\n\r\n\t}\r\n\r\n\tfunction drawBorder( style, which, x, y, width, height ) {\r\n\r\n\t\tconst borderWidth = style[ which + 'Width' ];\r\n\t\tconst borderStyle = style[ which + 'Style' ];\r\n\t\tconst borderColor = style[ which + 'Color' ];\r\n\r\n\t\tif ( borderWidth !== '0px' && borderStyle !== 'none' && borderColor !== 'transparent' && borderColor !== 'rgba(0, 0, 0, 0)' ) {\r\n\r\n\t\t\tcontext.strokeStyle = borderColor;\r\n\t\t\tcontext.lineWidth = parseFloat( borderWidth );\r\n\t\t\tcontext.beginPath();\r\n\t\t\tcontext.moveTo( x, y );\r\n\t\t\tcontext.lineTo( x + width, y + height );\r\n\t\t\tcontext.stroke();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction drawElement( element, style ) {\r\n\r\n\t\tlet x = 0, y = 0, width = 0, height = 0;\r\n\r\n\t\tif ( element.nodeType === Node.TEXT_NODE ) {\r\n\r\n\t\t\t// text\r\n\r\n\t\t\trange.selectNode( element );\r\n\r\n\t\t\tconst rect = range.getBoundingClientRect();\r\n\r\n\t\t\tx = rect.left - offset.left - 0.5;\r\n\t\t\ty = rect.top - offset.top - 0.5;\r\n\t\t\twidth = rect.width;\r\n\t\t\theight = rect.height;\r\n\r\n\t\t\tdrawText( style, x, y, element.nodeValue.trim() );\r\n\r\n\t\t} else if ( element.nodeType === Node.COMMENT_NODE ) {\r\n\r\n\t\t\treturn;\r\n\r\n\t\t} else if ( element instanceof HTMLCanvasElement ) {\r\n\r\n\t\t\t// Canvas element\r\n\t\t\tif ( element.style.display === 'none' ) return;\r\n\r\n\t\t\tcontext.save();\r\n\t\t\tconst dpr = window.devicePixelRatio;\r\n\t\t\tcontext.scale( 1 / dpr, 1 / dpr );\r\n\t\t\tcontext.drawImage( element, 0, 0 );\r\n\t\t\tcontext.restore();\r\n\r\n\t\t} else if ( element instanceof HTMLImageElement ) {\r\n\r\n\t\t\tif ( element.style.display === 'none' ) return;\r\n\r\n\t\t\tconst rect = element.getBoundingClientRect();\r\n\r\n\t\t\tx = rect.left - offset.left - 0.5;\r\n\t\t\ty = rect.top - offset.top - 0.5;\r\n\t\t\twidth = rect.width;\r\n\t\t\theight = rect.height;\r\n\r\n\t\t\tcontext.drawImage( element, x, y, width, height );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif ( element.style.display === 'none' ) return;\r\n\r\n\t\t\tconst rect = element.getBoundingClientRect();\r\n\r\n\t\t\tx = rect.left - offset.left - 0.5;\r\n\t\t\ty = rect.top - offset.top - 0.5;\r\n\t\t\twidth = rect.width;\r\n\t\t\theight = rect.height;\r\n\r\n\t\t\tstyle = window.getComputedStyle( element );\r\n\r\n\t\t\t// Get the border of the element used for fill and border\r\n\r\n\t\t\tbuildRectPath( x, y, width, height, parseFloat( style.borderRadius ) );\r\n\r\n\t\t\tconst backgroundColor = style.backgroundColor;\r\n\r\n\t\t\tif ( backgroundColor !== 'transparent' && backgroundColor !== 'rgba(0, 0, 0, 0)' ) {\r\n\r\n\t\t\t\tcontext.fillStyle = backgroundColor;\r\n\t\t\t\tcontext.fill();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// If all the borders match then stroke the round rectangle\r\n\r\n\t\t\tconst borders = [ 'borderTop', 'borderLeft', 'borderBottom', 'borderRight' ];\r\n\r\n\t\t\tlet match = true;\r\n\t\t\tlet prevBorder = null;\r\n\r\n\t\t\tfor ( const border of borders ) {\r\n\r\n\t\t\t\tif ( prevBorder !== null ) {\r\n\r\n\t\t\t\t\tmatch = ( style[ border + 'Width' ] === style[ prevBorder + 'Width' ] ) &&\r\n\t\t\t\t\t( style[ border + 'Color' ] === style[ prevBorder + 'Color' ] ) &&\r\n\t\t\t\t\t( style[ border + 'Style' ] === style[ prevBorder + 'Style' ] );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( match === false ) break;\r\n\r\n\t\t\t\tprevBorder = border;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( match === true ) {\r\n\r\n\t\t\t\t// They all match so stroke the rectangle from before allows for border-radius\r\n\r\n\t\t\t\tconst width = parseFloat( style.borderTopWidth );\r\n\r\n\t\t\t\tif ( style.borderTopWidth !== '0px' && style.borderTopStyle !== 'none' && style.borderTopColor !== 'transparent' && style.borderTopColor !== 'rgba(0, 0, 0, 0)' ) {\r\n\r\n\t\t\t\t\tcontext.strokeStyle = style.borderTopColor;\r\n\t\t\t\t\tcontext.lineWidth = width;\r\n\t\t\t\t\tcontext.stroke();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// Otherwise draw individual borders\r\n\r\n\t\t\t\tdrawBorder( style, 'borderTop', x, y, width, 0 );\r\n\t\t\t\tdrawBorder( style, 'borderLeft', x, y, 0, height );\r\n\t\t\t\tdrawBorder( style, 'borderBottom', x, y + height, width, 0 );\r\n\t\t\t\tdrawBorder( style, 'borderRight', x + width, y, 0, height );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( element instanceof HTMLInputElement ) {\r\n\r\n\t\t\t\tlet accentColor = style.accentColor;\r\n\r\n\t\t\t\tif ( accentColor === undefined || accentColor === 'auto' ) accentColor = style.color;\r\n\r\n\t\t\t\tcolor.set( accentColor );\r\n\r\n\t\t\t\tconst luminance = Math.sqrt( 0.299 * ( color.r ** 2 ) + 0.587 * ( color.g ** 2 ) + 0.114 * ( color.b ** 2 ) );\r\n\t\t\t\tconst accentTextColor = luminance < 0.5 ? 'white' : '#111111';\r\n\r\n\t\t\t\tif ( element.type === 'radio' ) {\r\n\r\n\t\t\t\t\tbuildRectPath( x, y, width, height, height );\r\n\r\n\t\t\t\t\tcontext.fillStyle = 'white';\r\n\t\t\t\t\tcontext.strokeStyle = accentColor;\r\n\t\t\t\t\tcontext.lineWidth = 1;\r\n\t\t\t\t\tcontext.fill();\r\n\t\t\t\t\tcontext.stroke();\r\n\r\n\t\t\t\t\tif ( element.checked ) {\r\n\r\n\t\t\t\t\t\tbuildRectPath( x + 2, y + 2, width - 4, height - 4, height );\r\n\r\n\t\t\t\t\t\tcontext.fillStyle = accentColor;\r\n\t\t\t\t\t\tcontext.strokeStyle = accentTextColor;\r\n\t\t\t\t\t\tcontext.lineWidth = 2;\r\n\t\t\t\t\t\tcontext.fill();\r\n\t\t\t\t\t\tcontext.stroke();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( element.type === 'checkbox' ) {\r\n\r\n\t\t\t\t\tbuildRectPath( x, y, width, height, 2 );\r\n\r\n\t\t\t\t\tcontext.fillStyle = element.checked ? accentColor : 'white';\r\n\t\t\t\t\tcontext.strokeStyle = element.checked ? accentTextColor : accentColor;\r\n\t\t\t\t\tcontext.lineWidth = 1;\r\n\t\t\t\t\tcontext.stroke();\r\n\t\t\t\t\tcontext.fill();\r\n\r\n\t\t\t\t\tif ( element.checked ) {\r\n\r\n\t\t\t\t\t\tconst currentTextAlign = context.textAlign;\r\n\r\n\t\t\t\t\t\tcontext.textAlign = 'center';\r\n\r\n\t\t\t\t\t\tconst properties = {\r\n\t\t\t\t\t\t\tcolor: accentTextColor,\r\n\t\t\t\t\t\t\tfontFamily: style.fontFamily,\r\n\t\t\t\t\t\t\tfontSize: height + 'px',\r\n\t\t\t\t\t\t\tfontWeight: 'bold'\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\tdrawText( properties, x + ( width / 2 ), y, '✔' );\r\n\r\n\t\t\t\t\t\tcontext.textAlign = currentTextAlign;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( element.type === 'range' ) {\r\n\r\n\t\t\t\t\tconst [ min, max, value ] = [ 'min', 'max', 'value' ].map( property => parseFloat( element[ property ] ) );\r\n\t\t\t\t\tconst position = ( ( value - min ) / ( max - min ) ) * ( width - height );\r\n\r\n\t\t\t\t\tbuildRectPath( x, y + ( height / 4 ), width, height / 2, height / 4 );\r\n\t\t\t\t\tcontext.fillStyle = accentTextColor;\r\n\t\t\t\t\tcontext.strokeStyle = accentColor;\r\n\t\t\t\t\tcontext.lineWidth = 1;\r\n\t\t\t\t\tcontext.fill();\r\n\t\t\t\t\tcontext.stroke();\r\n\r\n\t\t\t\t\tbuildRectPath( x, y + ( height / 4 ), position + ( height / 2 ), height / 2, height / 4 );\r\n\t\t\t\t\tcontext.fillStyle = accentColor;\r\n\t\t\t\t\tcontext.fill();\r\n\r\n\t\t\t\t\tbuildRectPath( x + position, y, height, height, height / 2 );\r\n\t\t\t\t\tcontext.fillStyle = accentColor;\r\n\t\t\t\t\tcontext.fill();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( element.type === 'color' || element.type === 'text' || element.type === 'number' ) {\r\n\r\n\t\t\t\t\tclipper.add( { x: x, y: y, width: width, height: height } );\r\n\r\n\t\t\t\t\tdrawText( style, x + parseInt( style.paddingLeft ), y + parseInt( style.paddingTop ), element.value );\r\n\r\n\t\t\t\t\tclipper.remove();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t// debug\r\n\t\tcontext.strokeStyle = '#' + Math.random().toString( 16 ).slice( - 3 );\r\n\t\tcontext.strokeRect( x - 0.5, y - 0.5, width + 1, height + 1 );\r\n\t\t*/\r\n\r\n\t\tconst isClipping = style.overflow === 'auto' || style.overflow === 'hidden';\r\n\r\n\t\tif ( isClipping ) clipper.add( { x: x, y: y, width: width, height: height } );\r\n\r\n\t\tfor ( let i = 0; i < element.childNodes.length; i ++ ) {\r\n\r\n\t\t\tdrawElement( element.childNodes[ i ], style );\r\n\r\n\t\t}\r\n\r\n\t\tif ( isClipping ) clipper.remove();\r\n\r\n\t}\r\n\r\n\tconst offset = element.getBoundingClientRect();\r\n\r\n\tlet canvas = canvases.get( element );\r\n\r\n\tif ( canvas === undefined ) {\r\n\r\n\t\tcanvas = document.createElement( 'canvas' );\r\n\t\tcanvas.width = offset.width;\r\n\t\tcanvas.height = offset.height;\r\n\t\tcanvases.set( element, canvas );\r\n\r\n\t}\r\n\r\n\tconst context = canvas.getContext( '2d'/*, { alpha: false }*/ );\r\n\r\n\tconst clipper = new Clipper( context );\r\n\r\n\t// console.time( 'drawElement' );\r\n\r\n\tdrawElement( element );\r\n\r\n\t// console.timeEnd( 'drawElement' );\r\n\r\n\treturn canvas;\r\n\r\n}\r\n\r\nfunction htmlevent( element, event, x, y ) {\r\n\r\n\tconst mouseEventInit = {\r\n\t\tclientX: ( x * element.offsetWidth ) + element.offsetLeft,\r\n\t\tclientY: ( y * element.offsetHeight ) + element.offsetTop,\r\n\t\tview: element.ownerDocument.defaultView\r\n\t};\r\n\r\n\t// TODO: Find out why this is added. Keep commented out when this file is updated\r\n\t// window.dispatchEvent( new MouseEvent( event, mouseEventInit ) );\r\n\r\n\tconst rect = element.getBoundingClientRect();\r\n\r\n\tx = x * rect.width + rect.left;\r\n\ty = y * rect.height + rect.top;\r\n\r\n\tfunction traverse( element ) {\r\n\r\n\t\tif ( element.nodeType !== Node.TEXT_NODE && element.nodeType !== Node.COMMENT_NODE ) {\r\n\r\n\t\t\tconst rect = element.getBoundingClientRect();\r\n\r\n\t\t\tif ( x > rect.left && x < rect.right && y > rect.top && y < rect.bottom ) {\r\n\r\n\t\t\t\telement.dispatchEvent( new MouseEvent( event, mouseEventInit ) );\r\n\r\n\t\t\t\tif ( element instanceof HTMLInputElement && element.type === 'range' && ( event === 'mousedown' || event === 'click' ) ) {\r\n\r\n\t\t\t\t\tconst [ min, max ] = [ 'min', 'max' ].map( property => parseFloat( element[ property ] ) );\r\n\r\n\t\t\t\t\tconst width = rect.width;\r\n\t\t\t\t\tconst offsetX = x - rect.x;\r\n\t\t\t\t\tconst proportion = offsetX / width;\r\n\t\t\t\t\telement.value = min + ( max - min ) * proportion;\r\n\t\t\t\t\telement.dispatchEvent( new InputEvent( 'input', { bubbles: true } ) );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tfor ( let i = 0; i < element.childNodes.length; i ++ ) {\r\n\r\n\t\t\t\ttraverse( element.childNodes[ i ] );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\ttraverse( element );\r\n\r\n}\r\n\r\nexport { HTMLMesh };\r\n","/* jshint esversion: 9, -W097 */\r\n/* For dealing with spline curves */\r\n/* global THREE, AFRAME, setTimeout, console */\r\n'use strict';\r\n\r\nimport { HTMLMesh } from './HTMLMesh.js';\r\n\r\nconst schemaHTML = {\r\n\thtml: {\r\n\t\ttype: 'selector',\r\n\t},\r\n\tcursor: {\r\n\t\ttype: 'selector',\r\n\t}\r\n};\r\n\r\ndocumentation:\r\n{\r\n\tschemaHTML.html.description = `HTML element to use.`;\r\n\tschemaHTML.cursor.description = `Visual indicator for where the user is currently pointing`;\r\n}\r\n\r\nconst _pointer = new THREE.Vector2();\r\nconst _event = { type: '', data: _pointer };\r\nAFRAME.registerComponent('html', {\r\n\tschema: schemaHTML,\r\n\tinit() {\r\n\t\tthis.rerender = this.rerender.bind(this);\r\n\t\tthis.handle = this.handle.bind(this);\r\n\t\tthis.onClick = e => this.handle('click', e);\r\n\t\tthis.onMouseLeave = e => this.handle('mouseleave', e);\r\n\t\tthis.onMouseEnter = e => this.handle('mouseenter', e);\r\n\t\tthis.onMouseUp = e => this.handle('mouseup', e);\r\n\t\tthis.onMouseDown = e => this.handle('mousedown', e);\r\n\t\tthis.mouseMoveDetail = {\r\n\t\t\tdetail: {\r\n\t\t\t\tcursorEl: null,\r\n\t\t\t\tintersection: null\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\tplay() {\r\n\t\tthis.el.addEventListener('click', this.onClick);\r\n\t\tthis.el.addEventListener('mouseleave', this.onMouseLeave);\r\n\t\tthis.el.addEventListener('mouseenter', this.onMouseEnter);\r\n\t\tthis.el.addEventListener('mouseup', this.onMouseUp);\r\n\t\tthis.el.addEventListener('mousedown', this.onMouseDown);\r\n\t},\r\n\tpause() {\r\n\t\tthis.el.removeEventListener('click', this.onClick);\r\n\t\tthis.el.removeEventListener('mouseleave', this.onMouseLeave);\r\n\t\tthis.el.removeEventListener('mouseenter', this.onMouseEnter);\r\n\t\tthis.el.removeEventListener('mouseup', this.onMouseUp);\r\n\t\tthis.el.removeEventListener('mousedown', this.onMouseDown);\r\n\t},\r\n\tupdate() {\r\n\t\tthis.remove();\r\n\t\tif (!this.data.html) return;\r\n\t\tconst mesh = new HTMLMesh(this.data.html);\r\n\t\tthis.el.setObject3D('html', mesh);\r\n\t\tthis.data.html.addEventListener('input', this.rerender);\r\n\t\tthis.data.html.addEventListener('change', this.rerender);\r\n\t\tthis.cursor = this.data.cursor ? this.data.cursor.object3D : null;\r\n\t},\r\n\ttick() {\r\n\t\tif (this.activeRaycaster) {\r\n\t\t\tconst intersection = this.activeRaycaster.components.raycaster.getIntersection(this.el);\r\n\t\t\tthis.mouseMoveDetail.detail.cursorEl = this.activeRaycaster;\r\n\t\t\tthis.mouseMoveDetail.detail.intersection = intersection;\r\n\t\t\tthis.handle('mousemove', this.mouseMoveDetail);\r\n\t\t}\r\n\t},\r\n\thandle(type, evt) {\r\n\t\tconst intersection = evt.detail.intersection;\r\n\t\tconst raycaster = evt.detail.cursorEl;\r\n\t\tif (type === 'mouseenter') {\r\n\t\t\tthis.activeRaycaster = raycaster;\r\n\t\t}\r\n\t\tif (type === 'mouseleave' && this.activeRaycaster === raycaster) {\r\n\t\t\tthis.activeRaycaster = null;\r\n\t\t}\r\n\t\tif (this.cursor) this.cursor.visible = false;\r\n\t\tif (intersection) {\r\n\t\t\tconst mesh = this.el.getObject3D('html');\r\n\t\t\tconst uv = intersection.uv;\r\n\t\t\t_event.type = type;\r\n\t\t\t_event.data.set( uv.x, 1 - uv.y );\r\n\t\t\tmesh.dispatchEvent( _event );\r\n\r\n\t\t\tif (this.cursor) {\r\n\t\t\t\tthis.cursor.visible = true;\r\n\t\t\t\tthis.cursor.parent.worldToLocal(this.cursor.position.copy(intersection.point));\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\trerender() {\r\n\t\tconst mesh = this.el.getObject3D('html');\r\n\t\tif (mesh && !mesh.material.map.scheduleUpdate) {\r\n\t\t\tmesh.material.map.scheduleUpdate = setTimeout( () => mesh.material.map.update(), 16 );\r\n\t\t}\r\n\t},\r\n\tremove() {\r\n\t\tconst mesh = this.el.getObject3D('html');\r\n\t\tif (mesh) {\r\n\t\t\tthis.el.removeObject3D('html');\r\n\t\t\tthis.data.html.removeEventListener('input', this.rerender);\r\n\t\t\tthis.data.html.removeEventListener('change', this.rerender);\r\n\t\t\tmesh.dispose();\r\n\t\t}\r\n\t\tthis.activeRaycaster = null;\r\n\t\tthis.mouseMoveDetail.detail.cursorEl = null;\r\n\t\tthis.mouseMoveDetail.detail.intersection = null;\r\n\t\tthis.cursor = null;\r\n\t},\r\n});\r\n"],"names":["HTMLMesh","Mesh","constructor","dom","texture","HTMLTexture","geometry","PlaneGeometry","image","width","height","material","MeshBasicMaterial","map","toneMapped","transparent","onEvent","event","dispatchDOMEvent","super","this","addEventListener","dispose","canvases","delete","removeEventListener","CanvasTexture","html2canvas","anisotropy","encoding","sRGBEncoding","minFilter","LinearFilter","magFilter","observer","MutationObserver","scheduleUpdate","setTimeout","update","observe","attributes","childList","subtree","characterData","data","element","x","y","mouseEventInit","clientX","offsetWidth","offsetLeft","clientY","offsetHeight","offsetTop","view","ownerDocument","defaultView","rect","getBoundingClientRect","traverse","nodeType","Node","TEXT_NODE","COMMENT_NODE","left","right","top","bottom","dispatchEvent","MouseEvent","HTMLInputElement","type","min","max","property","parseFloat","proportion","value","InputEvent","bubbles","i","childNodes","length","htmlevent","needsUpdate","disconnect","clearTimeout","WeakMap","range","document","createRange","color","Color","drawText","style","string","textTransform","toUpperCase","context","font","fontWeight","fontSize","fontFamily","textBaseline","fillStyle","fillText","buildRectPath","w","h","r","beginPath","moveTo","arcTo","closePath","drawBorder","which","borderWidth","borderStyle","borderColor","strokeStyle","lineWidth","lineTo","stroke","offset","canvas","get","undefined","createElement","set","getContext","clipper","clips","isClipping","doClip","restore","minX","Infinity","minY","maxX","maxY","clip","Math","save","add","push","remove","pop","drawElement","selectNode","nodeValue","trim","HTMLCanvasElement","display","dpr","window","devicePixelRatio","scale","drawImage","HTMLImageElement","getComputedStyle","borderRadius","backgroundColor","fill","borders","match","prevBorder","border","borderTopWidth","borderTopStyle","borderTopColor","accentColor","accentTextColor","sqrt","g","b","checked","currentTextAlign","textAlign","position","parseInt","paddingLeft","paddingTop","overflow","_event","THREE","Vector2","AFRAME","registerComponent","schema","html","cursor","init","rerender","bind","handle","onClick","e","onMouseLeave","onMouseEnter","onMouseUp","onMouseDown","mouseMoveDetail","detail","cursorEl","intersection","play","el","pause","mesh","setObject3D","object3D","tick","activeRaycaster","components","raycaster","getIntersection","evt","visible","getObject3D","uv","parent","worldToLocal","copy","point","removeObject3D"],"mappings":"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"}